plugins {
  id 'maven-publish'
}

apply from: "$rootDir/gradle/java.gradle"

// TODO this is not the desired state, only reflects current reality
minimumBranchCoverage = 0
minimumInstructionCoverage = 0

configurations {
  // classpath used by the instrumentation muzzle plugin
  instrumentationMuzzle
}

dependencies {
  compile(project(':auto-bootstrap')) {
    // This only needs to exist in the bootstrap, not the instrumentation jar.
    exclude group: 'org.slf4j', module: 'slf4j-simple'
  }
  compile(project(':utils:thread-utils'))

  compile deps.opentelemetryApi
  compile deps.opentelemetrySdk
  compile deps.opentelemetrySdkAutoConfig
  compile deps.opentelemetryTraceProps

  compile group: 'com.blogspot.mydailyjava', name: 'weak-lock-free', version: '0.15'
  compile deps.bytebuddy
  compile deps.bytebuddyagent
  annotationProcessor deps.autoservice
  implementation deps.autoservice

  testCompile project(':testing')

  instrumentationMuzzle sourceSets.main.output
  instrumentationMuzzle configurations.compile
}

publishing {
  publications {
    mavenJava(MavenPublication) {
      from components.java
    }
  }
}
